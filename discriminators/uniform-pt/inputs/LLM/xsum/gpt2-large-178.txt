 affected millions of children, many of whom now have social media accounts of their own.

Instead, the Investigatory Powers Tribunal said the Government did not have a valid legal basis for the plans.

The Government said it was right to change the law after the Edward Snowden revelations. "This is a big step forward. We have put this law in place to protect children and that should be true. It is right that children should learn to protect their private and personal information – especially the internet is the safest place to let their thoughts and feelings be free." But the move has been criticised by charities, including Save the Children who argue families should be able to share personal information online without being subject to mass surveillance. They say privacy laws that apply to the likes of Google and Facebook already apply to traditional news organisations such as MailOnline and the Telegraph.

But the Government's comments yesterday were described as a "huge step in legitimising a new era of mass surveillance".

David Anderson, director of Big Brother Watch, said: "It is a huge defeat for democratic rights when the UK Government decides to invade children's privacy, but it is good that the Government at least has the authority and courage to tackle the issue.

"This is a momentous decision. A vote to support the plans today means the Government will not be able to use its new powers to spy on all British citizens in addition to those in the UK. The decision is a significant step in legitimising a new era of mass surveillance – and is a vote for democracy and freedom and human rights over mass surveillance."

Gavin Barwell, chair of internet security group CloudFlare, said the Government's proposals were "invasive and unacceptable".

He said: "CloudFlare is thrilled to have played a role in ensuring this controversial measure gets defeated in this way, and in doing so has helped to protect thousands of